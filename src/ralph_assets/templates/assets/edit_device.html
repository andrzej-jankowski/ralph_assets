{% extends 'assets/add_assets.html' %}
{% load assets %}
{% load bob %}

{% block form_title %}Edit device{% endblock %}

{% block additional_inputs %}
  {% for field in additional_info %}
    {% field_wrapper field %}
  {% endfor %}
{% endblock %}

{% include 'assets/attachment_table.html' with attachment_parent=asset mode=mode parent_name='asset'%}

{% block info_tables %}
  <div>
      <h6><a href="{{ history_link }}">Full history</a></h6>
  </div>
  {% if status_history %}
      <div>
          <h5>Status history</h5>
          <table class="table table-striped table-bordered details-history">
              <thead><tr>
                  <th>Date</th>
                  <th>Author</th>
                  <th>Before</th>
                  <th>After</th>
              </tr></thead>
              <tbody>
              {% for h in status_history %}
                  <tr>
                      <td>{{ h.date|timesince_limited }}</td>
                      <td>{{ h.user|default:'' }}</td>
                      <td>{{ h.old_value }}</td>
                      <td>{{ h.new_value }}</td>
                  </tr>
              {% endfor %}
              </tbody>
          </table>
      </div>
{% endif %}

  {% transition_history asset %}

  <div>
    <h5>Device parts</h5>
    {% if parts %}
    <table class="table table-striped table-bordered details-history">
        <thead><tr>
            <th></th>
            <th>Name</th>
            <th>Source device</th>
            <th>Author</th>
        </tr></thead>
        <tbody>
        {% for part in parts%}
            <tr>
                <td><input type="checkbox" name="part_ids" value="{{ part.id }}"></td>
                <td><a href="../../../edit/part/{{ part.id }}">{{ part }}</a></td>
                <td><a href="../../../edit/device/{{ part.part_info.source_device.id }}">{{ part.part_info.source_device|default:'-'}}</a></td>
                <td>{{ part.user|default:'-'}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="pull-left">
      <div class="pull-left">
      {% for field in part_form %}
          {{ field.label }}: {{ field }}
      {% endfor %}
      </div>
      <button class="btn btn-primary pull-left" name="move_parts"  type="submit">Move part</button>
    </div>
    {% endif %}
    {% if not asset.has_parts %}
      {% spaceless %}
      <div class="pull-left">
        <a href="{% url device_split mode='dc' asset_id=asset.id %}" class="btn btn-danger">
          <i class="fugue-icon fugue-cutter"></i>&nbsp;Split device
        </a>
      </div>
      {% endspaceless %}
    {% endif %}
    <div class="pull-right">
        <a href="../../../add/part?device={{asset.id}}" class="btn btn-primary">Add part</a>
    </div>
  </div>
{% endblock %}
